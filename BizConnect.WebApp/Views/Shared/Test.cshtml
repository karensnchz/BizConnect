@using BizConnect.WebApp.Models
@model LayoutModel
@{
    bool editable = Model.OperationType == OperationType.Create || Model.OperationType == OperationType.Edit;
}
<div class="editor-label">
    @Html.LabelFor(model => model.Layout.Name)
</div>
<div class="editor-field">
    <input id="layoutName" type="text" value="@(Model.Layout.Name ?? "")" @(editable ? "" : "readonly") />
    @if (Roles.IsUserInRole("Owner"))
    {
        <select id="companies">
            @foreach (var company in Model.Companies)
            {
                <option data-company-id="@company.CompanyId">@company.Name</option>
                @* data-address="@company.Address" data-phone="@company.Phone"*@
            }
        </select>
    }
</div>
<div id="message" />
<fieldset>
    <legend>Layout</legend>
    @Html.ValidationSummary(true)
    <div id="layout">
@*        <div id="companyInfo" class="ui-draggable">
            <label id="companyName" />
            <br />
            <label id="companyAddress" />
            <br />
            <label id="companyPhone" />
        </div>*@
        @if (Model.Layout.Elements != null)
        {
            foreach (var e in Model.Layout.Elements)
            {
                if (e.ElementType == "boolean")
                {
            <div class="wrapper element" data-width="@e.Width" data-height="@e.Height" data-top="@e.YPosition" data-left="@e.XPosition">
                <input name="@e.Name" type="checkbox" data-element-id="@e.ElementId" @(editable ? "" : "disabled") />
                @if (editable)
                {
                    <label for="@e.Name">@e.Name</label>
                }
                else
                {
                    <input type="text" value="@e.Name"/>
                }
            </div>
                }
                else
                {
            <div class="wrapper" data-width="@e.Width" data-height="@e.Height" data-top="@e.YPosition" data-left="@e.XPosition">
                <input class="element" type="text" value="@e.Name" data-element-id="@e.ElementId" @(editable ? "" : "readonly") />
            </div>
                }
            }
        }
    </div>
</fieldset>
<script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
<script type="text/javascript">

    function refreshCompany() {
        var item = $('#companies :selected');
        $('#companyName').html(item.text());
        $('#companyPhone').html(item.data('phone'));
        $('#companyAddress').html(item.data('address'));
    }

    $(function () {

        $('.wrapper').each(function () {
            $(this).width($(this).data('width'));
            $(this).height($(this).data('height'));
            $(this).position({
                my: 'left top',
                at: 'left top',
                of: $('#layout'),
                offset: $(this).data('left') + " " + $(this).data('top')
            }).makeAbsolute();
        });


        refreshCompany();
        $('#companies').change(refreshCompany);
    });
</script>
